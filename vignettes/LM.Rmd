---
title: "Linear models: Introduction"
author: "Alexandre Courtiol"
date: "`r Sys.Date()`"
output:
  ioslides_presentation:
    widescreen: true
    smaller: true
vignette: >
  %\VignetteIndexEntry{2.0 Linear models}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---
```{r setup, include=FALSE}
library(LM2GLMM)
```

## What is a Linear Model (LM)?

### What is a statistical model?

###***A statistical model represents, often in considerably idealized form, the data-generating process.*** [(wikipedia)](https://en.wikipedia.org/wiki/Statistical_model)
<br>

### What is a linear model?

###***The data-generating process is assumed to be a linear function: it is constructed from a set of terms by multiplying each term by a constant (a model parameter) and adding the results .***

# Notations

## Mathematical notation of LM: simple notation

<center><font size="5"> $y_i = \beta_0 + \beta_1 \times x_{1,i} + \beta_2 \times x_{2,i} + \dots + \beta_{p} \times x_{p,i} + \epsilon_i$ </font></center>

<br>

* $y_i$ = the observations to explain / explanatory variable / dependent variable
* $x_{j,i}$ = constants derived from the predictors / explanatory variables / independent variables
* $\beta_j$ = the regression coefficients / model parameters
* $\epsilon_i$ = the errors (not the same thing as residuals!)


## Mathematical notation of LM: matrix notation

<center><font size = 8> $Y = X \beta + \epsilon$ </font></center>

$$
\begin{bmatrix} y_1 \\ y_2 \\ y_3 \\ \dots \\ y_n \end{bmatrix} =
\begin{bmatrix}
1 & x_{1,1} & x_{2,1} & \dots & x_{p,1} \\
1 & x_{1,2} & x_{2,2} & \dots & x_{p,2} \\
1 & x_{1,3} & x_{2,3} & \dots & x_{p,3} \\
\dots & \dots & \dots & \dots & \dots \\
1 & x_{1,n} & x_{2,n} & \dots & x_{p,n}
\end{bmatrix}
\begin{bmatrix}
\beta_0 \\ \beta_1 \\ \beta_2 \\ \beta_3 \\ \dots \\ \beta_n
\end{bmatrix} +
\begin{bmatrix}
\epsilon_1 \\ \epsilon_2 \\ \epsilon_3 \\ \dots \\ \epsilon_n
\end{bmatrix}
$$

<br>

* $Y$ = a vector of observations
* $X$ = an matrix called the design (or model) matrix
* $\beta$ = a vector of model parameters
* $\epsilon$ = a vector of errors

# The response

## What kind of responses LM can handle?

* one dimension: $n \times 1$
* continuous
* no other restriction

# The design matrix

## The design matrix

* multi-dimensional: $n \times p$ with $n > p$
* deduced from the predictors
* known and measured without error
* columns shoud be linearly independent

## How to get the design (or model) matrix?

```{r pred matrix}
somedata <- data.frame(x1 = 1:6)
model.matrix(object = ~ x1, data = somedata)
```

## A more simple design matrix
```{r pred matrix 0}
model.matrix(object = ~ 0 + x1, data = somedata)
model.matrix(object = ~ -1 + x1, data = somedata)
```


## A more complex design matrix

```{r pred matrix 2}
somedata$x2 <- c(10, 11, 12, 13, 14, 15)
somedata$x3 <- factor(c("b", "b", "a", "a", "c", "c"))
(MA <- model.matrix(object = ~ x1 + x2 + x3, data = somedata))
```

## An alternative representation of the more complex design matrix

```{r pred matrix 3}
(MB <- model.matrix(object = ~ x1 + x2 + x3, data = somedata, contrasts.arg = list(x3 = "contr.helmert")))
```

# The model parameters

## Model parameters:

* one dimension: $p \times 1$ vector
* fixed unobservable quantities

### The meaning of the parameters depends on the model matrix:

<div  class="columns-2">

```{r param MA}
BetaA <-  matrix(c(50, 1.5, 20, 2, 3))
rownames(BetaA) <-
  c("intercept", "x1", "x2", "x3b", "x3c")
MA %*% BetaA
```

<br>

```{r param MB}
BetaB <-  matrix(c(51.66667, 1.5, 20, 1, 0.66667))
rownames(BetaB) <- 
  c("intercept","x1", "x2", "x31", "x32")
MB %*% BetaB
```

</div>

## Conversion from one type of contrasts to another

```{r}
solve(cbind(1, contr.helmert(levels(somedata$x3))),
      cbind(1, contr.treatment(levels(somedata$x3))) %*% BetaA[c("intercept", "x3b", "x3c"),])
```


## Exercise

Explore the differences in the design matrix stemming from coding the gender as:

* ```"boy"``` vs ```"girl"```
* ```"male"``` vs ```"female"```
* ```0``` vs ```1```
* ```1``` vs ```2```
* ```TRUE``` vs ```FALSE```


# The errors

## The errors

* one dimension: $n \times 1$ vector
* equal observation - model approximation ($Y - X\beta$)
* random variable
* we assume it Gaussian, independent and identically distributed (homoscedasticity)

<center><font size="8"> $\epsilon \sim \mathcal{N}(0, \sigma^2 I)$</font></center>

###The covariance matrix $\sigma^2 I$

* square matrix: $n \times n$

$$
\begin{bmatrix}
\sigma^2 & 0 & \dots & 0 \\
0 & \sigma^2 & \dots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \dots & \sigma^2 \\
\end{bmatrix}
$$


# Illustration with the Alien dataset

## Imagine an ideal (unrealistic) situation

We know that the process generating the height of aliens can be
approximated by the following linear model:

* $\texttt{height}_i = 50 + 1.5 \times \texttt{humans_eaten}_{i} + \epsilon_i$
* $\epsilon_i \sim \mathcal{N}(0, \sigma^2 = 25)$

<br>

We can thus generate the data corresponding to 6 aliens that have eaten
between 1 and 6 humans.

```{r alien data}
set.seed(123L)
Alien <- data.frame(humans_eaten = sample(1:6))
Alien$error <- rnorm(n = 6, mean = 0, sd = sqrt(25))
Alien$size <- 50 + 1.5*Alien$humans_eaten + Alien$error
```

We could also write the last 2 lines as the following line, but we want to keep the error distinct here.
```{r alien data2, eval = FALSE}
Alien$size <- rnorm(n = 6, mean = 50 + 1.5*Alien$humans_eaten, sd = sqrt(25))
```

## Computing the response with both notations

```{r alien data show}
Alien
```
<div class="columns-2">

### Simple notation
* $y_1 = 50 + 1.5 \times `r Alien$humans_eaten[1]` + `r Alien$error[1]`$
* $y_2 = 50 + 1.5 \times `r Alien$humans_eaten[2]` + `r Alien$error[2]`$
* $y_3 = 50 + 1.5 \times `r Alien$humans_eaten[3]` + `r Alien$error[3]`$
* $y_4 = 50 + 1.5 \times `r Alien$humans_eaten[4]` + `r Alien$error[4]`$
* $y_5 = 50 + 1.5 \times `r Alien$humans_eaten[5]` + `r Alien$error[5]`$
* $y_6 = 50 + 1.5 \times `r Alien$humans_eaten[6]` + `r Alien$error[6]`$

### Matrix notation
$$
Y = \begin{bmatrix}
1 & `r Alien$humans_eaten[1]` \\
1 & `r Alien$humans_eaten[2]` \\
1 & `r Alien$humans_eaten[3]` \\
1 & `r Alien$humans_eaten[4]` \\
1 & `r Alien$humans_eaten[5]` \\
1 & `r Alien$humans_eaten[6]`
\end{bmatrix}
\begin{bmatrix}
50 \\
1.5
\end{bmatrix}
+
\begin{bmatrix}
`r Alien$error[1]`\\
`r Alien$error[2]`\\
`r Alien$error[3]`\\
`r Alien$error[4]`\\
`r Alien$error[5]`\\
`r Alien$error[6]`
\end{bmatrix}
$$

</div>


## Matrix multiplication in R

```{r matrix multiplication}
X <- model.matrix(object = ~ humans_eaten, data = Alien)
B <- matrix(c(50, 1.5), ncol = 1)
X %*% B
```
```{r matrix sum}
E <- as.matrix(Alien$error)
X %*% B + E
```



# Table of content

## The Linear Model: LM

2.1 [Fitting Linear Models](./fitting_LM.html)
