---
title: "Exercise: 1. Fungi LM"
author: "Alexandre Courtiol"
date: "`r Sys.Date()`"
output: 
  html_vignette
vignette: >
  %\VignetteIndexEntry{Exercise: 1. Fungi LM}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---
  ```{r setup, include=FALSE}
library(LM2GLMM)
```

## Preparing the data

```{r}
FungiAlive <- subset(Fungi, alive == TRUE)
```

## Looking at the data structure

```{r}
table(FungiAlive$T36, FungiAlive$T38, FungiAlive$species)
table(FungiAlive$PT36, FungiAlive$PT38, FungiAlive$species)
```

## Creating the pre-treatment variable

```{r}
FungiAlive$PT <- "no"
FungiAlive$PT[FungiAlive$PT36 == 1] <- "36"
FungiAlive$PT[FungiAlive$PT38 == 1] <- "38"
FungiAlive$PT <- factor(FungiAlive$PT)
table(FungiAlive$PT, FungiAlive$species)
```

## Creating the treatment variable

```{r}
FungiAlive$T <- "no"
FungiAlive$T[FungiAlive$T36 == 1] <- "36"
FungiAlive$T[FungiAlive$T38 == 1] <- "38"
FungiAlive$T <- factor(FungiAlive$T)
table(FungiAlive$T, FungiAlive$species)
```


## Combining pre-treatment and treatement

```{r}
FungiAlive$condition <-
  factor(paste(FungiAlive$species, FungiAlive$PT, FungiAlive$T, sep = "_"))
  table(FungiAlive$condition)
```


## Fitting the model and predicting the effects: solution 1

```{r}
m1 <- lm(growth ~ -1 + condition, data = FungiAlive)
data.frame(coef(m1))
```

## Fitting the model and predicting the effects: solution 2

```{r}
(m2 <- lm(growth ~ species * (PT + T), data = FungiAlive))
newdata2 <- data.frame(PT = c("36", "38", "no", "no", "36", "38", "no", "no"),
                       T = c("36", "38", "36", "38", "36", "38", "36", "38"),
                       species = c(rep("M_A", 4), rep("M_B", 4)))
newdata2$pred <- predict(m2, newdata = newdata2)
newdata2
```

```{r, fig.height=5, fig.width=5, fig.align="center"}
plot(newdata2[newdata2$species == "M_A", "pred"],
     type = "b", axes = FALSE, col = "red",
     ylim = range(newdata2$pred),
     ylab = "Growth rate", xlab = "Experimental condition")
points(newdata2[newdata2$species == "M_B", "pred"],
       type = "b", col = "blue")
axis(side = 2, las = 1)
axis(side = 1, at = 1:4,
     labels = c("36_36", "38_38", "no_36", "no_38"))
box()
legend("top", pch = c(1, 1), col = c("blue", "red"), horiz = TRUE,
       legend = c("M_A", "M_B"), box.lty = 2, title = "Species")
```
